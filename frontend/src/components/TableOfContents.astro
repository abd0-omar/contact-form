---
import type { MarkdownHeading } from "astro";

interface Props {
    headings: MarkdownHeading[];
}

const { headings } = Astro.props;

// Filter to only show h2, h3, h4 headings for better navigation
const tocHeadings = headings.filter((h) => h.depth >= 2 && h.depth <= 4);
---

{
    tocHeadings.length > 0 && (
        <nav
            class="article-nav fixed right-2 top-1/2 transform -translate-y-1/2 block w-40 z-50"
            aria-label="Table of Contents"
        >
            <div class="bg-base-200 rounded-box border border-base-300 shadow-xl p-2 backdrop-blur-sm">
                <ul class="space-y-1 text-xs">
                    {tocHeadings.map((heading) => (
                        <li
                            class={`${heading.depth === 2 ? "pl-0" : heading.depth === 3 ? "pl-1" : "pl-2"}`}
                        >
                            <a
                                href={`#${heading.slug}`}
                                class="toc-link group block py-1 px-1.5 rounded transition-all duration-200 ease-out
                                       text-base-content/70 hover:text-primary hover:bg-base-300/30
                                       border-l-2 border-transparent hover:border-primary/40
                                       text-xs leading-tight relative overflow-hidden"
                            >
                                {heading.text}
                            </a>
                        </li>
                    ))}
                </ul>
            </div>
        </nav>
    )
}

<style>
    /* Smooth scrolling behavior */
    html {
        scroll-behavior: smooth;
    }

    /* Add scroll margin to headings for better anchor positioning (exclude H1 - main title) */
    :global(.prose h2),
    :global(.prose h3),
    :global(.prose h4),
    :global(.prose h5),
    :global(.prose h6) {
        scroll-margin-top: 6rem;
    }

    /* Enhanced backdrop blur effect with better opacity */
    .article-nav > div {
        backdrop-filter: blur(12px);
        background-color: hsl(var(--b2) / 0.98);
        box-shadow: 0 8px 32px hsl(var(--bc) / 0.08);
    }

    /* Responsive positioning - only hide on very small screens */
    @media (max-width: 1024px) {
        .article-nav {
            display: none;
        }
    }

    /* Enhanced animations and hover states */
    .article-nav a {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
    }

    .article-nav a::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 2px;
        background: transparent;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .article-nav a:hover {
        transform: translateX(3px);
        color: hsl(var(--p));
    }

    .article-nav a:hover::before {
        background: hsl(var(--p) / 0.3);
    }
</style>
